'use client';

import { DateTime } from 'luxon';
import { useFormatter, useTranslations } from 'next-intl';
import Image from 'next/image';
import { useContext, useMemo } from 'react';

import { AuctionTypeBadge, CategoryBadge, EndingSoonBadge } from '@/components/Badge';
import { Id } from '@/components/Id';
import {
	Anchor,
	Avatar,
	Breadcrumbs,
	Container,
	Divider,
	Group,
	Stack,
	Text,
	Title,
} from '@mantine/core';
import {
	IconBox,
	IconChevronRight,
	IconClock,
	IconCloudHeart,
	IconDiamond,
	IconHeartbeat,
	IconHourglassEmpty,
	IconLeaf,
} from '@tabler/icons-react';

import { AuctionDetailsContext } from '../constants';
import classes from './styles.module.css';

export default function Details() {
	const t = useTranslations();
	const format = useFormatter();
	const { auctionData } = useContext(AuctionDetailsContext);

	return (
		<Group className={classes.root}>
			<Container className={classes.image}>
				<Image
					src={auctionData.image || '/imgs/industry/flare.jpg'}
					alt={'Image of a power plant'}
					fill
				/>
			</Container>
			<Stack className={classes.content}>
				<Stack className={classes.details}>
					<Breadcrumbs
						separator={<IconChevronRight size={14} />}
						classNames={{
							root: classes.breadcrumbs,
							separator: classes.separator,
						}}
					>
						<Anchor href="/marketplace">Marketplace</Anchor>
						<Anchor>Industry</Anchor>
						<Anchor>Flare Gas Burning</Anchor>
					</Breadcrumbs>
					<Title className={classes.title}>Flare Gas Burning</Title>
					<Group className={classes.row}>
						<Group className={classes.section}>
							<CategoryBadge category={'industry'} />
							<AuctionTypeBadge type={auctionData.type} />
						</Group>
						<Group className={classes.section}>
							<EndingSoonBadge endDatetime={auctionData.endDatetime} />
						</Group>
					</Group>
					<Text className={classes.description}>
						{auctionData.description ||
							'This permit grants the owning company the right to emit a specified amount of fluorine gases generated by air conditioning units.'}
					</Text>
					<Group className={classes.row}>
						<Group className={classes.owner}>
							<Avatar
								className={classes.avatar}
								name={auctionData.owner && auctionData.owner.name}
							/>
							<Anchor
								className={classes.link}
								href={`/marketplace/firm/${auctionData.ownerId}`}
							>
								{auctionData.owner && auctionData.owner.name}
							</Anchor>
						</Group>
						<Id className={classes.id} value={auctionData.id} variant="industry" />
					</Group>
				</Stack>

				<Stack className={classes.properties}>
					<Divider
						label="Auction Details"
						classNames={{
							root: classes.divider,
							label: classes.label,
						}}
					/>
					<Stack className={classes.table}>
						<Group className={classes.row}>
							<Group className={classes.section}>
								<IconHourglassEmpty size={16} className={classes.icon} />
								<Text className={classes.key}>Permit Lifespan</Text>
								<Text className={classes.value}>1 year</Text>
							</Group>
							<Group className={classes.section}>
								<IconLeaf size={16} className={classes.icon} />
								<Text className={classes.key}>Emissions Per Permit</Text>
								<Text className={classes.value}>10,000 tCO2e</Text>
							</Group>
						</Group>
						<Group className={classes.row}>
							<Group className={classes.section}>
								<IconClock size={16} className={classes.icon} />
								<Text className={classes.key}>Auction Start Date</Text>
								<Text className={classes.value}>
									{DateTime.fromISO(auctionData.startDatetime).toLocaleString(
										DateTime.DATETIME_SHORT,
									)}
								</Text>
							</Group>
							<Group className={classes.section}>
								<IconDiamond size={16} className={classes.icon} />
								<Text className={classes.key}>Emission Quality</Text>
								<Text className={classes.value}>High Quality</Text>
							</Group>
						</Group>
					</Stack>
				</Stack>
				<Divider
					label="Permits Available"
					classNames={{
						root: classes.divider,
						label: classes.label,
					}}
				/>
			</Stack>
		</Group>
	);
}
